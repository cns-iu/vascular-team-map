\copy (WITH authors AS ( SELECT wos_summary_names.id, array_to_string(array_agg(wos_summary_names.display_name), '|') as author from wos_summary_names, vascular_authors WHERE wos_summary_names.id = vascular_authors.id and wos_summary_names.role like 'author' group by wos_summary_names.id ), titles AS ( select vascular_authors.id, wos_titles.title as titles from wos_titles, vascular_authors where wos_titles.id = vascular_authors.id and wos_titles.title_type = 'item' ), affiliations AS ( SELECT vascular_authors.id, array_to_string(array_agg(wos_address_organizations.organization), '|') as affiliated from wos_address_organizations, vascular_authors where wos_address_organizations.id = vascular_authors.id and wos_address_organizations.org_id = 1 group by vascular_authors.id ), journals AS ( SELECT vascular_authors.id, wos_titles.title as journal from wos_titles, vascular_authors where title_type='source' and wos_titles.id = vascular_authors.id ), issn AS ( SELECT vascular_authors.id, identifier_value as issns from vascular_authors, wos_dynamic_identifiers where identifier_type='issn' and wos_dynamic_identifiers.id = vascular_authors.id ), eissn AS ( SELECT vascular_authors.id, identifier_value as eissns from vascular_authors, wos_dynamic_identifiers where identifier_type='eissn' and wos_dynamic_identifiers.id = vascular_authors.id ) SELECT DISTINCT vascular_authors.id, wos_summary.pubyear, titles.titles, authors.author, affiliations.affiliated, wos_times_cited.wos_total, journals.journal, issn.issns, eissn.eissns FROM vascular_authors, wos_summary, titles, authors, affiliations, wos_times_cited, journals, issn, eissn WHERE titles.id = vascular_authors.id and authors.id = vascular_authors.id and titles.id = vascular_authors.id and affiliations.id = vascular_authors.id and journals.id = vascular_authors.id and issn.id = vascular_authors.id and eissn.id = vascular_authors.id and wos_times_cited.id = vascular_authors.id and wos_summary.id = vascular_authors.id ) to 'vascular-extract.csv' Delimiter ',' CSV HEADER Encoding 'SQL-ASCII' ;
